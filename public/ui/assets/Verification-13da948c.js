import{D,E as x,G as H,H as J,J as Q,K as U,M as $,N as X,O as Z,P as ee,Q as f,S as N,U as te,W as I,X as se,Y as O,Z as ae,a as o,F as ie,$ as oe,p as M,A as ne,a0 as B,a1 as re,a2 as le,a3 as ue,a4 as ce,a5 as de,a6 as he,a7 as fe,a8 as me,a9 as ge,aa as ve,ab as pe,ac as ye,ad as ke,ae as be,af as we,ag as Ve,_ as Ce,R as Pe,L as Re,r as Se,o as _,c as E,w as V,f as Ne,ah as w,b as T,t as Te,k as Le,y as Ae,d as Ie,ai as Me,aj as Be}from"./index-66536040.js";import{L as _e,V as Ee}from"./LoadingAndErrorSc-b2106c78.js";import{e as Fe,b as y,v as De,R as xe,f as Ue,i as $e,h as Oe,g as qe}from"./getCurrentUser-e1e6a7ca.js";import{v as L}from"./authController-74969fde.js";import{l as je}from"./logout-2dcaad44.js";import{V as We}from"./VOverlay-4ffdd9e4.js";import{V as F}from"./VContainer-43b90582.js";import"./getScrollParent-6bb6c202.js";import"./lazy-15f99f4f.js";async function Ye(e,t){return await Fe(y,e,t).then(a=>({state:!0,result:a})).catch(a=>({state:!1,result:a}))}async function Ke(e){return await De(y,e).then(async t=>({state:!0,result:t})).catch(t=>({state:!1,result:t}))}async function ze(e,t,a,r="normal"){return new xe(y,e,{size:r,callback:d=>{t()},"expired-callback":()=>{a()}})}async function Ge(e){return await Ue(y,e).then(()=>({state:!0,result:null})).catch(t=>({state:!1,result:t}))}async function He(e,t){return $e(y,t)?await Oe(y,e,t).then(a=>({state:!0,result:a})).catch(a=>({state:!1,result:a})):{state:!1,result:{message:"invalid link"}}}const Je=D({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...x(),...H(),...J(Q({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),Qe=U()({name:"VOtpInput",props:Je(),emits:{finish:e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:a,emit:r,slots:d}=t;const{dimensionStyles:m}=$(e),{isFocused:p,focus:g,blur:C}=X(e),l=Z(e,"modelValue","",s=>s==null?[]:String(s).split(""),s=>s.join("")),{t:P}=ee(),k=f(()=>Number(e.length)),q=f(()=>Array(k.value).fill(0)),h=N(-1),R=N(),v=N([]),S=f(()=>v.value[h.value]);function j(){if(A(S.value.value)){S.value.value="";return}const s=l.value.slice(),i=S.value.value;s[h.value]=i;let u=null;h.value>l.value.length?u=l.value.length+1:h.value+1!==k.value&&(u="next"),l.value=s,u&&B(R.value,u)}function W(s){const i=l.value.slice(),u=h.value;let c=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(s.key)&&(s.preventDefault(),s.key==="ArrowLeft"?c="prev":s.key==="ArrowRight"?c="next":["Backspace","Delete"].includes(s.key)&&(i[h.value]="",l.value=i,h.value>0&&s.key==="Backspace"?c="prev":requestAnimationFrame(()=>{var n;(n=v.value[u])==null||n.select()})),requestAnimationFrame(()=>{c!=null&&B(R.value,c)}))}function Y(s,i){var c,n;i.preventDefault(),i.stopPropagation();const u=((c=i==null?void 0:i.clipboardData)==null?void 0:c.getData("Text"))??"";A(u)||(l.value=u.split(""),(n=v.value)==null||n[s].blur())}function K(){l.value=[]}function z(s,i){g(),h.value=i}function G(){C(),h.value=-1}function A(s){return e.type==="number"&&/[^0-9]/g.test(s)}return te({VField:{color:f(()=>e.color),bgColor:f(()=>e.color),baseColor:f(()=>e.baseColor),disabled:f(()=>e.disabled),error:f(()=>e.error),variant:f(()=>e.variant)}},{scoped:!0}),I(l,s=>{s.length===k.value&&r("finish",s.join(""))},{deep:!0}),I(h,s=>{s<0||se(()=>{var i;(i=v.value[s])==null||i.select()})}),O(()=>{var u;const[s,i]=ae(a);return o("div",M({class:["v-otp-input",{"v-otp-input--divided":!!e.divider},e.class],style:[e.style]},s),[o("div",{ref:R,class:"v-otp-input__content",style:[m.value]},[q.value.map((c,n)=>o(ie,null,[e.divider&&n!==0&&o("span",{class:"v-otp-input__divider"},[e.divider]),o(oe,{focused:p.value&&e.focusAll||h.value===n,key:n},{...d,loader:void 0,default:()=>o("input",{ref:b=>v.value[n]=b,"aria-label":P(e.label,n+1),autofocus:n===0&&e.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:e.disabled,inputmode:e.type==="number"?"numeric":"text",min:e.type==="number"?0:void 0,maxlength:"1",placeholder:e.placeholder,type:e.type==="number"?"text":e.type,value:l.value[n],onInput:j,onFocus:b=>z(b,n),onBlur:G,onKeydown:W,onPaste:b=>Y(n,b)},null)})])),o("input",M({class:"v-otp-input-input",type:"hidden"},i,{value:l.value.join("")}),null),o(We,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!e.loading,persistent:!0},{default:()=>{var c;return[((c=d.loader)==null?void 0:c.call(d))??o(ne,{color:typeof e.loading=="boolean"?void 0:e.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(u=d.default)==null?void 0:u.call(d)])])}),{blur:()=>{var s;(s=v.value)==null||s.some(i=>i.blur())},focus:()=>{var s;(s=v.value)==null||s[0].focus()},reset:K,isFocused:p}}});const Xe=D({color:String,...re(),...le(),...x(),...ue(),...ce(),...de(),...he(),...fe(),...me()},"VSheet"),Ze=U()({name:"VSheet",props:Xe(),setup(e,t){let{slots:a}=t;const{themeClasses:r}=ge(e),{backgroundColorClasses:d,backgroundColorStyles:m}=ve(pe(e,"color")),{borderClasses:p}=ye(e),{dimensionStyles:g}=$(e),{elevationClasses:C}=ke(e),{locationStyles:l}=be(e),{positionClasses:P}=we(e),{roundedClasses:k}=Ve(e);return O(()=>o(e.tag,{class:["v-sheet",r.value,d.value,p.value,C.value,P.value,k.value,e.class],style:[m.value,g.value,l.value,e.style]},a)),{}}}),et={name:"Verification",components:{ResMsg:Pe,LogoComp:Re,LoadingAndErrorSc:_e},data:()=>({otp:"",actMode:"",continueUrl:"",contact:"",loading:!1,verifyLoading:!1,error:!1,msg:null,phoneConfirm:null,idToken:null,appVerifier:null,isNotRobot:!1}),async mounted(){await this.getParams()},methods:{getParams:async function(){const e=this.$route.query;if(this.actMode=e.mode,this.actMode==="phoneVerify")this.continueUrl=e.continueUrl,this.contact=e.phone,await this.checkNotRobot();else{if(this.otp=e.oobCode,this.continueUrl=e.continueUrl,this.actMode==="signIn"){this.loading=!0;const{state:t,result:a}=await He(this.contact,this.$route.href);if(this.loading=!1,this.error=!t,t){this.loading=!0,this.idToken=await a.user.getIdToken();const r=await L(this.idToken,this.contact);this.loading=!1,this.error=!r.state,this.msg=r.message,r.state&&this.$router.push(this.continueUrl)}else a.message.include("network-request-failed")?this.msg="Network Error: Check Connection And Refersh.":this.msg=a.message+`
Try To Login again`}if(this.actMode==="verifyEmail"){this.loading=!0;const{state:t,result:a}=await Ge(this.otp);if(console.log(a),t){this.idToken=await qe().getIdToken();const r=await L(this.idToken,this.contact);this.loading=!1,this.error=!r.state,this.msg=r.message,r.state&&(await je(),this.$router.push(this.continueUrl))}else a.message.includes("network-request-failed")?this.msg="Network Error: Check Connection And Refersh.":a.message.includes("expired-action-code")?this.msg="Expired Link":this.msg=a.message+`
Or Try Again...`}if(this.actMode==="resetPassword"){this.loading=!0,this.error=!1,this.msg=null;const{state:t,result:a}=await Ke(this.otp);t?this.$router.push({name:"ResetPassword",query:{contact:a,otp:this.otp}}):(this.error=!0,this.msg=a.message),this.loading=!1}this.actMode}},resend:async function(){this.actMode==="phoneVerify"&&await this.checkNotRobot()},checkNotRobot:async function(){this.actMode==="phoneVerify"&&!this.isNotRobot&&(this.loading=!0,this.appVerifier=await ze("recapVerifierId",async()=>{this.isNotRobot=!0,await this.sendSMSCode()},async()=>{this.isNotRobot=!1,await this.appVerifier.reset(),await this.appVerifier.render()}),await this.appVerifier.render(),this.loading=!1)},sendSMSCode:async function(){if(this.isNotRobot){this.loading=!0,this.msg=null,this.error=!1;const{state:e,result:t}=await Ye(this.contact,this.appVerifier);this.loading=!1,this.error=!e,e?this.phoneConfirm=t:t.message.includes("39")?this.msg="You request a lot of codes....":this.msg=t.message}else this.msg="Verify You Are Not Robot.."},confirmPhone:async function(){return this.phoneConfirm?await this.phoneConfirm.confirm(this.otp).then(async e=>({state:!0,result:e})).catch(e=>({state:!1,result:e})):{state:!0,result:null}},submit:async function(){if(this.otp.length===6){this.verifyLoading=!0,this.error=!1,this.msg=null;const{state:e,result:t}=await this.confirmPhone();if(this.error=!e,e)if(this.idToken=await t.user.getIdToken(),this.continueUrl.includes("resetpassword"))this.$router.push({name:"ResetPassword",query:{contact:this.contact,idToken:this.idToken}});else{const a=await L(this.idToken,this.contact);this.error=!a.state,this.msg=a.message,a.state&&this.$router.push(this.continueUrl)}else this.msg=t.message;this.verifyLoading=!1}else this.msg="Enter Correct Code"}}},tt=w("h3",{class:"text-h6 mb-4"},"Verify Your Account",-1),st={class:"text-body-2"},at=w("br",null,null,-1),it={class:"text-caption",color:"secondary"};function ot(e,t,a,r,d,m){const p=Se("loading-and-error-sc");return _(),E(Ee,{align:"center",justify:"center"},{default:V(()=>[o(p,{isLoading:e.loading,error:e.error,msg:e.msg},null,8,["isLoading","error","msg"]),o(F,null,{default:V(()=>[!e.loading&&!e.error&&(e.actMode!=="phoneVerify"||e.isNotRobot)&&e.actMode!=="signIn"?(_(),E(Ne,{key:0,class:"py-8 px-6 text-center mx-auto ma-4",elevation:"12","max-width":"400",width:"100%"},{default:V(()=>[tt,w("div",st,[T(" We sent a verification code to "+Te(e.contact),1),at,T(" Please Paste the code below. ")]),o(Ze,{color:"surface"},{default:V(()=>[o(Qe,{modelValue:e.otp,"onUpdate:modelValue":t[0]||(t[0]=g=>e.otp=g),variant:"solo"},null,8,["modelValue"])]),_:1}),o(Le,{loading:e.verifyLoading,disabled:e.verifyLoading,class:"my-4",color:"primary",height:"40",text:"Verify",variant:"flat",width:"70%",onClick:m.submit},null,8,["loading","disabled","onClick"]),w("div",it,[T(" Didn't receive the code? "),w("a",{href:"#",onClick:t[1]||(t[1]=Ae((...g)=>m.resend&&m.resend(...g),["prevent"]))},"Resend")])]),_:1})):Ie("",!0),Me(o(F,{id:"recapVerifierId",align:"center"},null,512),[[Be,e.actMode==="phoneVerify"&&!e.isNotRobot]])]),_:1})]),_:1})}const gt=Ce(et,[["render",ot]]);export{gt as default};
