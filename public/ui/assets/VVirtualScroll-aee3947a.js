import{D as E,a2 as L,K as W,bP as X,W as M,Y as Q,a as S,F as $,p as re,bz as se,aQ as w,a$ as U,S as q,Q as z,bl as K,b4 as B,bS as oe,X as ue,aX as ce,E as ie,bw as ve,M as de,ab as fe,bk as me,b3 as F,b0 as he}from"./index-66536040.js";import{a as ge}from"./getScrollParent-6bb6c202.js";const pe=E({renderless:Boolean,...L()},"VVirtualScrollItem"),Se=W()({name:"VVirtualScrollItem",inheritAttrs:!1,props:pe(),emits:{"update:height":l=>!0},setup(l,a){let{attrs:i,emit:s,slots:t}=a;const{resizeRef:n,contentRect:v}=X(void 0,"border");M(()=>{var u;return(u=v.value)==null?void 0:u.height},u=>{u!=null&&s("update:height",u)}),Q(()=>{var u,o;return l.renderless?S($,null,[(u=t.default)==null?void 0:u.call(t,{itemRef:n})]):S("div",re({ref:n,class:["v-virtual-scroll__item",l.class],style:l.style},i),[(o=t.default)==null?void 0:o.call(t)])})}}),Ve=-1,be=1,D=100,ye=E({itemHeight:{type:[Number,String],default:null},height:[Number,String]},"virtual");function Te(l,a){const i=se(),s=w(0);U(()=>{s.value=parseFloat(l.itemHeight||0)});const t=w(0),n=w(Math.ceil((parseInt(l.height)||i.height.value)/(s.value||16))||1),v=w(0),u=w(0),o=q(),g=q();let I=0;const{resizeRef:k,contentRect:x}=X();U(()=>{k.value=o.value});const y=z(()=>{var e;return o.value===document.documentElement?i.height.value:((e=x.value)==null?void 0:e.height)||parseInt(l.height)||0}),V=z(()=>!!(o.value&&g.value&&y.value&&s.value));let d=Array.from({length:a.value.length}),c=Array.from({length:a.value.length});const m=w(0);let b=-1;function Y(e){return d[e]||s.value}const _=oe(()=>{const e=performance.now();c[0]=0;const r=a.value.length;for(let f=1;f<=r-1;f++)c[f]=(c[f-1]||0)+Y(f-1);m.value=Math.max(m.value,performance.now()-e)},m),j=M(V,e=>{e&&(j(),I=g.value.offsetTop,_.immediate(),T(),~b&&ue(()=>{ce&&window.requestAnimationFrame(()=>{C(b),b=-1})}))});K(()=>{_.clear()});function G(e,r){const f=d[e],h=s.value;s.value=h?Math.min(s.value,r):r,(f!==r||h!==s.value)&&(d[e]=r,_())}function p(e){return e=B(e,0,a.value.length-1),c[e]||0}function H(e){return we(c,e)}let A=0,R=0,O=0;M(y,(e,r)=>{r&&(T(),e<r&&requestAnimationFrame(()=>{R=0,T()}))});function J(){if(!o.value||!g.value)return;const e=o.value.scrollTop,r=performance.now();r-O>500?(R=Math.sign(e-A),I=g.value.offsetTop):R=e-A,A=e,O=r,T()}function Z(){!o.value||!g.value||(R=0,O=0,T())}let N=-1;function T(){cancelAnimationFrame(N),N=requestAnimationFrame(ee)}function ee(){if(!o.value||!y.value)return;const e=A-I,r=Math.sign(R),f=Math.max(0,e-D),h=B(H(f),0,a.value.length),le=e+y.value+D,P=B(H(le)+1,h+1,a.value.length);if((r!==Ve||h<t.value)&&(r!==be||P>n.value)){const ae=p(t.value)-p(h),ne=p(P)-p(n.value);Math.max(ae,ne)>D?(t.value=h,n.value=P):(h<=0&&(t.value=h),P>=a.value.length&&(n.value=P))}v.value=p(t.value),u.value=p(a.value.length)-p(n.value)}function C(e){const r=p(e);!o.value||e&&!r?b=e:o.value.scrollTop=r}const te=z(()=>a.value.slice(t.value,n.value).map((e,r)=>({raw:e,index:r+t.value})));return M(a,()=>{d=Array.from({length:a.value.length}),c=Array.from({length:a.value.length}),_.immediate(),T()},{deep:!0}),{containerRef:o,markerRef:g,computedItems:te,paddingTop:v,paddingBottom:u,scrollToIndex:C,handleScroll:J,handleScrollend:Z,handleItemResize:G}}function we(l,a){let i=l.length-1,s=0,t=0,n=null,v=-1;if(l[i]<a)return i;for(;s<=i;)if(t=s+i>>1,n=l[t],n>a)i=t-1;else if(n<a)v=t,s=t+1;else return n===a?t:s;return v}const Ie=E({items:{type:Array,default:()=>[]},renderless:Boolean,...ye(),...L(),...ie()},"VVirtualScroll"),xe=W()({name:"VVirtualScroll",props:Ie(),setup(l,a){let{slots:i}=a;const s=ve("VVirtualScroll"),{dimensionStyles:t}=de(l),{containerRef:n,markerRef:v,handleScroll:u,handleScrollend:o,handleItemResize:g,scrollToIndex:I,paddingTop:k,paddingBottom:x,computedItems:y}=Te(l,fe(l,"items"));return me(()=>l.renderless,()=>{function V(){var m,b;const c=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:!1)?"addEventListener":"removeEventListener";n.value===document.documentElement?(document[c]("scroll",u,{passive:!0}),document[c]("scrollend",o)):((m=n.value)==null||m[c]("scroll",u,{passive:!0}),(b=n.value)==null||b[c]("scrollend",o))}he(()=>{n.value=ge(s.vnode.el,!0),V(!0)}),K(V)}),Q(()=>{const V=y.value.map(d=>S(Se,{key:d.index,renderless:l.renderless,"onUpdate:height":c=>g(d.index,c)},{default:c=>{var m;return(m=i.default)==null?void 0:m.call(i,{item:d.raw,index:d.index,...c})}}));return l.renderless?S($,null,[S("div",{ref:v,class:"v-virtual-scroll__spacer",style:{paddingTop:F(k.value)}},null),V,S("div",{class:"v-virtual-scroll__spacer",style:{paddingBottom:F(x.value)}},null)]):S("div",{ref:n,class:["v-virtual-scroll",l.class],onScrollPassive:u,onScrollend:o,style:[t.value,l.style]},[S("div",{ref:v,class:"v-virtual-scroll__container",style:{paddingTop:F(k.value),paddingBottom:F(x.value)}},[V])])}),{scrollToIndex:I}}});export{xe as V};
