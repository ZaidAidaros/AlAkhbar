import{I as B,V as M}from"./VMenu-ac2a7250.js";import{L as O,A as N}from"./ArticleMenuList-2973686f.js";import{_ as L,R as w,u as S,r as a,o as c,l as b,a as t,w as n,j as p,v as R,x as P,f as U,y as E,g,b as r,t as i,e as _,F as v,c as d,d as h,z as C,h as D,k as y,n as q,A as z,B as j,C as x}from"./index-9ba368a2.js";import{V}from"./VRow-41e0a699.js";import{L as T}from"./LoadingAndErrorSc-d526a2a3.js";import{V as G}from"./VVirtualScroll-d2e4c9be.js";import"./VOverlay-cf499a1e.js";import"./getScrollParent-6bb6c202.js";import"./lazy-31b61e80.js";const H={components:{ResMsg:w},props:["articleId","comment"],emits:["onSubmit"],data(){return{loading:!1,error:!1,msg:null,commentContent:null}},updated(){this.comment&&(this.commentContent=this.comment.comment)},methods:{required:e=>!!e||"Required.",onSubmit:async function(){const e=this.$store.getters.isAuth;if(this.commentContent&&e){this.error=!1,this.msg=null,this.loading=!0;let s=null;this.comment?(this.comment.comment=this.commentContent,s=await S.updateArticleComment(this.comment),s.state&&(s.comment=this.comment)):(s=await S.sendArticleComment({articleId:this.articleId,comment:this.commentContent}),s.state&&(s.comment.user=this.$store.getters.getUser)),this.loading=!1,s.state&&(this.$emit("onSubmit",s.comment),this.commentContent=null),this.error=!s.state,this.msg=s.message,setTimeout(()=>{this.error=!1,this.msg=null},2e3)}else this.error=!0,this.msg="Can Not Send Empty Comment",setTimeout(()=>{this.msg=null,this.error=!1},2e3)}}};function J(e,s,m,I,o,l){const u=a("res-msg");return c(),b(v,null,[t(_,{flat:"",class:"d-flex flex","max-height":"100px"},{default:n(()=>[t(p,null,{default:n(()=>[t(R,{onSubmit:P(l.onSubmit,["prevent"])},{default:n(()=>[t(U,{modelValue:o.commentContent,"onUpdate:modelValue":s[0]||(s[0]=f=>o.commentContent=f),color:"primary",label:"Comment",variant:"underlined"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(E,{end:""},{default:n(()=>[t(g,{loading:o.loading,color:"primary",class:"ma-4","append-icon":"mdi-send",type:"submit",end:"",onClick:l.onSubmit},{default:n(()=>[r(i(e.$t("comment")),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),t(u,{msg:o.msg,error:o.error},null,8,["msg","error"])],64)}const K=L(H,[["render",J]]),Q={props:["comment","userId"],emits:["onDeleted","onEdit"],components:{ResMsg:w},data:()=>({isLoading:!1,error:!1,msg:null}),methods:{deleteComment:async function(){if(this.userId===this.comment.userId){this.isLoading=!0,this.error=!1,this.msg=null;const e=await S.deleteArticleComment(this.comment.Id);this.isLoading=!1,e.state&&this.$emit("onDeleted",this.comment),this.error=!e.state,this.msg=e.message,setTimeout(()=>{this.msg=null,this.error=!1},2e3)}},onEditComment:function(){this.$emit("onEdit",this.comment)}}};function W(e,s,m,I,o,l){const u=a("res-msg");return c(),d(_,{class:"ma-2"},{default:n(()=>[t(V,null,{default:n(()=>[r(i(m.comment.user.name)+" ",1),m.comment.userId===m.userId?(c(),d(V,{key:0},{default:n(()=>[t(g,{color:"primary",variant:"text","prepend-icon":"mdi-note-edit",onClick:l.onEditComment},{default:n(()=>[r(i(e.$t("edit")),1)]),_:1},8,["onClick"]),t(g,{color:"red",onClick:l.deleteComment,loading:e.isLoading,variant:"text","prepend-icon":"mdi-note-remove"},{default:n(()=>[r(i(e.$t("delete")),1)]),_:1},8,["onClick","loading"])]),_:1})):h("",!0)]),_:1}),t(u,{msg:e.msg,error:e.error},null,8,["msg","error"]),t(p,{class:"ml-2"},{default:n(()=>[r(i(m.comment.comment),1)]),_:1}),t(C,null,{default:n(()=>[r(i(new Date(m.comment.updatedAt).toDateString()),1)]),_:1})]),_:1})}const X=L(Q,[["render",W]]),Y={name:"CommentsList",props:["articleId"],components:{CommentForm:K,CommentComp:X,LoadingAndErrorSc:T},data(){return{isLoading:!0,error:!1,page:0,msg:null,myId:null,coment:null,articleComments:[]}},async mounted(){this.$store.getters.isAuth&&(this.myId=this.$store.getters.getUser.Id),await this.loadArticleComments()},methods:{onCommentDeleted:function(e){const s=this.articleComments.filter(m=>m.Id!==e.Id);this.articleComments=s},onEditComment:function(e){this.coment=e},onCommentSubmit:function(e){if(this.coment){const s=this.articleComments.filter(m=>m.Id!==e.Id);this.articleComments=s,this.articleComments.push(e),this.coment=null}else this.articleComments.push(e)},loadArticleComments:async function(){this.isLoading=!0,this.msg=null,this.error=!1;const e=await D.loadArticleComments(this.page,this.articleId);this.isLoading=!1,e.state&&e.comments?this.articleComments.push(...e.comments):(this.error=!0,this.msg=e.message)}}};function Z(e,s,m,I,o,l){const u=a("CommentComp"),f=a("LoadingAndErrorSc"),k=a("CommentForm");return c(),d(y,{class:"mb-4",align:"center"},{default:n(()=>[t(y,null,{default:n(()=>[o.articleComments.length?(c(),d(G,{key:0,items:o.articleComments,"max-height":"400px"},{default:n(({item:A})=>[t(u,{comment:A,userId:o.myId,onOnDeleted:l.onCommentDeleted,onOnEdit:l.onEditComment},null,8,["comment","userId","onOnDeleted","onOnEdit"])]),_:1},8,["items"])):h("",!0)]),_:1}),t(f,{isLoading:o.isLoading,msg:o.msg,error:o.error},null,8,["isLoading","msg","error"]),o.myId?(c(),d(k,{key:0,articleId:m.articleId,comment:o.coment,onOnSubmit:l.onCommentSubmit},null,8,["articleId","comment","onOnSubmit"])):h("",!0)]),_:1})}const ee=L(Y,[["render",Z]]),te={name:"ArticlePage",components:{LikeComp:O,CommentsList:ee,ImageComp:B,LoadingAndErrorSc:T,ArticleMenuList:N},data:()=>({isLoading:!1,error:!1,msg:null,showComments:!1,article:null}),async mounted(){const e=this.$store.getters.getArticle;if(e)this.article=e;else{this.isLoading=!0,this.error=!1,this.msg=null;const s=await D.loadArticle(this.$route.params.id);this.isLoading=!1,s.state?this.article=s.article:(this.error=!0,this.msg=s.message)}},computed:{likes(){return this.article.articleLikes?this.article.articleLikes:[]},comments(){return this.article.articleComments?this.article.articleComments:[]},commentsCount(){return this.comments.length}},methods:{onShowComments:function(){this.showComments=!this.showComments}}};function ne(e,s,m,I,o,l){const u=a("LoadingAndErrorSc"),f=a("ArticleMenuList"),k=a("ImageComp"),A=a("like-comp"),$=a("CommentsList");return c(),b(v,null,[t(u,{isLoading:e.isLoading,msg:e.msg,error:e.error},null,8,["isLoading","msg","error"]),!e.isLoading&&!e.error&&e.article?(c(),d(_,{key:0,flat:"",class:"pa-2"},{default:n(()=>[t(_,{flat:"",class:"mb-4 text-primary"},{default:n(()=>[t(M,null,{activator:n(({props:F})=>[t(g,q({icon:"mdi-dots-vertical"},F,{flat:""}),null,16)]),default:n(()=>[t(f,{article:e.article},null,8,["article"])]),_:1}),r(" "+i(e.article.title),1)]),_:1}),e.article.writter?(c(),d(C,{key:0},{default:n(()=>[r(i(e.$t("writer"))+": ",1),z("strong",null,i(e.article.writter.name),1)]),_:1})):h("",!0),t(C,null,{default:n(()=>[r(i(String(e.article.updatedAt).split("T")[0]),1)]),_:1}),t(C,null,{default:n(()=>[r(i(String(e.article.updatedAt).split("T")[1].slice(0,5)),1)]),_:1}),t(p,null,{default:n(()=>[r(i(e.article.shortContent),1)]),_:1}),t(k,{src:e.article.image,alt:e.article.title,mx_h:"300px",mx_w:"300px"},null,8,["src","alt"]),t(p,null,{default:n(()=>[r(i(e.article.content),1)]),_:1}),t(E,null,{default:n(()=>[t(A,{"article-likes":l.likes,"article-id":e.article.Id},null,8,["article-likes","article-id"]),t(j),t(g,{size:"small",class:"mx-2",flat:"",variant:"text",color:"secondary","append-icon":this.showComments?"mdi-comment-text":"mdi-comment-text-multiple",onClick:l.onShowComments},{default:n(()=>[r(i(e.$t("showComments")),1)]),_:1},8,["append-icon","onClick"])]),_:1}),t(x),e.showComments?(c(),d($,{key:1,articleId:e.article.Id},null,8,["articleId"])):h("",!0)]),_:1})):h("",!0)],64)}const ue=L(te,[["render",ne]]);export{ue as default};
