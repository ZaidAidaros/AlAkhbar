import{s as k,a as c}from"./authController-3e261cfa.js";import{s as U}from"./signin-3203c69d.js";import{s as q,g as A,a as M,b as T}from"./getCurrentUser-5b8b8b29.js";import{_ as E,R as F,L,C as R,c as h,w as a,e as p,r as n,o as g,a as t,V as z,b as l,t as i,z as V,v as S,x as Y,f as w,g as f,B as y,j as N,k as B}from"./index-7074a3b4.js";import{z as D}from"./vue-tel-input-c134c468.js";import{V as b}from"./VRow-1afe2516.js";import{V as j}from"./VCheckbox-b74672df.js";async function H(e){return await q(A(),{url:{}.APPUI_DOMAIN+e,handleCodeInApp:!0}).then(()=>({state:!0,result:null})).catch(s=>({state:!1,result:s}))}async function O(e,s){return await M(T,e,{url:{}.APPUI_DOMAIN+s,handleCodeInApp:!0}).then(r=>({state:!0,result:r})).catch(r=>({state:!1,result:r}))}const Z={name:"LogIn",components:{ResMsg:F,LogoComp:L,VueTelInput:D,LangToggleComp:R},data:()=>({passwordVisible:!1,loading:!1,forgetloading:!1,error:!1,msg:null,usePhone:!1,email:null,phone:null,password:null,rules:{required:e=>!!e||"Required.",password:e=>e.length>=6&&e.length<=20||"Max 20 characters , Min 6",phone:e=>(e==null?void 0:e.length)<=10?!0:"Name must be less than 10 characters.",email:e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"Invalid e-mail."}}),async mounted(){const e=this.$route.query;this.email=e.email,this.phone=e.phone,this.phone&&(this.usePhone=!0)},methods:{logIn:async function(){if((await this.$refs.logInForm.validate()).valid){this.loading=!0,this.error=!1,this.msg=null;const s=await k({phoneEmail:this.usePhone?this.phone:this.email,password:this.password});if(this.loading=!1,this.error=!s.state,this.error&&(this.msg=s.message),s.state&&s.isVerified&&(this.msg=s.message,this.$store.dispatch("logIn",s),this.$router.push({name:"Home"})),s.state&&!s.isVerified)if(this.usePhone)this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/login"}});else{this.loading=!0;const{state:r,result:u}=await U(this.email,this.password);if(r){const d=await H("/login");d.state?this.msg=s.message:(this.error=!0,this.msg=d.result.message)}else this.error=!0,this.msg=u.message;this.loading=!1}}else this.msg="Must Fill All Fields Correctly",this.error=!0},foregetPassword:async function(){if(this.usePhone)if(this.phone){this.forgetloading=!0,this.error=!1,this.msg=null;const e=await c(this.phone);this.forgetloading=!1,this.error=!e.state,this.msg=e.message,e.state&&this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/resetpassword"}})}else this.error=!0,this.msg="Must provide phone number";else if(await this.$refs.em.validate()){this.forgetloading=!0,this.error=!1,this.msg=null;const s=await c(this.email);if(this.error=!s.state,this.msg=s.message,s.state){const{state:r,result:u}=await O(this.email,"/resetpassword");r?this.msg="We Sent You Email To Reset Password":(this.error=!0,this.msg=u.message)}this.forgetloading=!1}else this.error=!0,this.msg="Must provide email"}}};function W(e,s,r,u,d,m){const C=n("router-link"),P=n("LangToggleComp"),$=n("logo-comp"),I=n("vue-tel-input"),v=n("res-msg");return g(),h(p,{class:"mx-auto py-4 px-8",elevation:"8","max-width":"448",rounded:"lg",align:"center"},{default:a(()=>[t(b,{justify:"center",align:"center"},{default:a(()=>[t(z,null,{default:a(()=>[l(i(e.$t("login")),1)]),_:1}),t(V),t(C,{to:{name:"Home"}},{default:a(()=>[l(i(e.$t("home")),1)]),_:1}),t(P)]),_:1}),t($,{size:"150"}),t(B,null,{default:a(()=>[t(S,{ref:"logInForm",onSubmit:Y(m.logIn,["prevent"])},{default:a(()=>[t(j,{class:"my-0",modelValue:e.usePhone,"onUpdate:modelValue":s[0]||(s[0]=o=>e.usePhone=o),color:"secondary",label:e.$t("usePhone")},null,8,["modelValue","label"]),e.usePhone?(g(),h(p,{key:0,flat:""},{default:a(()=>[t(I,{modelValue:e.phone,"onUpdate:modelValue":s[1]||(s[1]=o=>e.phone=o),mode:"international",defaultCountry:"Ye",autoFormat:""},null,8,["modelValue"])]),_:1})):(g(),h(p,{key:1,flat:""},{default:a(()=>[t(w,{modelValue:e.email,"onUpdate:modelValue":s[2]||(s[2]=o=>e.email=o),ref:"em",rules:[e.rules.required,e.rules.email],color:"primary",label:e.$t("inlYourEmail"),placeholder:e.$t("inpYourEmail"),variant:"underlined"},null,8,["modelValue","rules","label","placeholder"])]),_:1})),t(w,{modelValue:e.password,"onUpdate:modelValue":s[3]||(s[3]=o=>e.password=o),rules:[e.rules.required,e.rules.password],"append-inner-icon":e.passwordVisible?"mdi-eye-off":"mdi-eye",type:e.passwordVisible?"text":"password","onClick:appendInner":s[4]||(s[4]=o=>e.passwordVisible=!e.passwordVisible),class:"mt-4",color:"primary",label:e.$t("inlYourPassword"),placeholder:e.$t("inpYourPassword"),variant:"underlined"},null,8,["modelValue","rules","append-inner-icon","type","label","placeholder"])]),_:1},8,["onSubmit"]),t(b,null,{default:a(()=>[t(V),t(f,{flat:"",onClick:m.foregetPassword,loading:e.forgetloading,class:"text-caption text-decoration-none text-blue justify-end",rel:"noopener noreferrer"},{default:a(()=>[l(i(e.$t("forgetPass")),1)]),_:1},8,["onClick","loading"])]),_:1}),t(y,{class:"my-2"}),t(v,{msg:e.msg,error:e.error},null,8,["msg","error"]),t(y,{class:"my-2"}),t(f,{loading:e.loading,disabled:e.loading,block:"",color:"primary",size:"large",type:"submit",variant:"elevated",onClick:m.logIn},{default:a(()=>[l(i(e.$t("login")),1)]),_:1},8,["loading","disabled","onClick"]),t(N,null,{default:a(()=>[l(i(e.$t("notSignUp"))+" ",1),t(f,{end:"",flat:"",variant:"text",class:"text-decoration-none text-secondary",to:{name:"SignUp"}},{default:a(()=>[l(i(e.$t("signup")),1)]),_:1})]),_:1})]),_:1})]),_:1})}const ee=E(Z,[["render",W]]);export{ee as default};
