import{V as E,I as N}from"./VMenu-1e9d216b.js";import{L as R,A as U}from"./ArticleMenuList-d3e17ec4.js";import{_,R as D,u as k,r as a,o as c,l as v,a as t,w as s,j as g,v as q,x as P,f as x,y as z,g as C,b as l,t as r,e as p,F as $,c as d,V as j,n as F,q as G,s as A,d as f,z as y,h as T,k as w,A as H,i as S,B as J,C as K}from"./index-94f5182d.js";import{L as B}from"./LoadingAndErrorSc-18061d63.js";import{V as Q}from"./VVirtualScroll-87940481.js";import{V as b}from"./VRow-faee6db4.js";import"./VOverlay-d8fad7e3.js";import"./getScrollParent-6bb6c202.js";import"./lazy-8e629b09.js";const W={components:{ResMsg:D},props:["articleId","comment"],emits:["onSubmit"],data(){return{loading:!1,error:!1,msg:null,commentContent:null}},updated(){this.comment&&(this.commentContent=this.comment.comment)},methods:{required:e=>!!e||"Required.",onSubmit:async function(){const e=this.$store.getters.isAuth;if(this.commentContent&&e){this.error=!1,this.msg=null,this.loading=!0;let n=null;this.comment?(this.comment.comment=this.commentContent,n=await k.updateArticleComment(this.comment),n.state&&(n.comment=this.comment)):(n=await k.sendArticleComment({articleId:this.articleId,comment:this.commentContent}),n.state&&(n.comment.user=this.$store.getters.getUser)),this.loading=!1,n.state&&(this.$emit("onSubmit",n.comment),this.commentContent=null),this.error=!n.state,this.msg=n.message,setTimeout(()=>{this.error=!1,this.msg=null},2e3)}else this.error=!0,this.msg="Can Not Send Empty Comment",setTimeout(()=>{this.msg=null,this.error=!1},2e3)}}};function X(e,n,i,L,o,m){const u=a("res-msg");return c(),v($,null,[t(p,{flat:"",class:"d-flex flex","max-height":"100px"},{default:s(()=>[t(g,null,{default:s(()=>[t(q,{onSubmit:P(m.onSubmit,["prevent"])},{default:s(()=>[t(x,{modelValue:o.commentContent,"onUpdate:modelValue":n[0]||(n[0]=h=>o.commentContent=h),color:"primary",label:e.$t("comment"),variant:"underlined"},null,8,["modelValue","label"])]),_:1},8,["onSubmit"])]),_:1}),t(z,{end:""},{default:s(()=>[t(C,{loading:o.loading,color:"primary",class:"ma-4","append-icon":"mdi-send",type:"submit",end:"",onClick:m.onSubmit},{default:s(()=>[l(r(e.$t("send")),1)]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),t(u,{msg:o.msg,error:o.error},null,8,["msg","error"])],64)}const Y=_(W,[["render",X]]),Z={props:["comment","userId"],emits:["onDeleted","onEdit"],components:{ResMsg:D},data:()=>({isLoading:!1,error:!1,msg:null}),methods:{deleteComment:async function(){if(this.userId===this.comment.userId){this.isLoading=!0,this.error=!1,this.msg=null;const e=await k.deleteArticleComment(this.comment.Id);this.isLoading=!1,e.state&&this.$emit("onDeleted",this.comment),this.error=!e.state,this.msg=e.message,setTimeout(()=>{this.msg=null,this.error=!1},2e3)}},onEditComment:function(){this.$emit("onEdit",this.comment)}}};function ee(e,n,i,L,o,m){const u=a("res-msg");return c(),d(p,{class:"ma-2"},{default:s(()=>[t(j,null,{default:s(()=>[i.comment.userId===i.userId?(c(),d(E,{key:0},{activator:s(({props:h})=>[t(C,F({icon:"mdi-dots-vertical"},h,{flat:""}),null,16)]),default:s(()=>[t(G,null,{default:s(()=>[t(A,{title:e.$t("edit"),"append-icon":"mdi-note-edit",color:"orange",onClick:m.onEditComment},null,8,["title","onClick"]),t(A,{title:e.$t("delete"),"append-icon":"mdi-note-remove",color:"red",loading:e.isLoading,onClick:m.deleteComment},null,8,["title","loading","onClick"])]),_:1})]),_:1})):f("",!0),l(" "+r(i.comment.user.name),1)]),_:1}),t(u,{msg:e.msg,error:e.error},null,8,["msg","error"]),t(g,{class:"ml-2"},{default:s(()=>[l(r(i.comment.comment),1)]),_:1}),t(y,null,{default:s(()=>[l(r(new Date(i.comment.updatedAt).toDateString()),1)]),_:1})]),_:1})}const te=_(Z,[["render",ee]]),se={name:"CommentsList",props:["articleId"],components:{CommentForm:Y,CommentComp:te,LoadingAndErrorSc:B},data(){return{isLoading:!0,error:!1,page:0,msg:null,myId:null,coment:null,articleComments:[]}},async mounted(){this.$store.getters.isAuth&&(this.myId=this.$store.getters.getUser.Id),await this.loadArticleComments()},methods:{onCommentDeleted:function(e){const n=this.articleComments.filter(i=>i.Id!==e.Id);this.articleComments=n},onEditComment:function(e){this.coment=e},onCommentSubmit:function(e){if(this.coment){const n=this.articleComments.filter(i=>i.Id!==e.Id);this.articleComments=n,this.articleComments.push(e),this.coment=null}else this.articleComments.push(e)},loadArticleComments:async function(){this.isLoading=!0,this.msg=null,this.error=!1;const e=await T.loadArticleComments(this.page,this.articleId);this.isLoading=!1,e.state&&e.comments?this.articleComments.push(...e.comments):(this.error=!0,this.msg=e.message)}}};function ne(e,n,i,L,o,m){const u=a("CommentComp"),h=a("LoadingAndErrorSc"),I=a("CommentForm");return c(),d(w,{class:"mb-4",align:"center"},{default:s(()=>[t(w,{align:"start"},{default:s(()=>[o.articleComments.length?(c(),d(Q,{key:0,items:o.articleComments,"max-height":"400px"},{default:s(({item:V})=>[t(u,{comment:V,userId:o.myId,onOnDeleted:m.onCommentDeleted,onOnEdit:m.onEditComment},null,8,["comment","userId","onOnDeleted","onOnEdit"])]),_:1},8,["items"])):f("",!0)]),_:1}),t(h,{isLoading:o.isLoading,msg:o.msg,error:o.error},null,8,["isLoading","msg","error"]),o.myId?(c(),d(I,{key:0,articleId:i.articleId,comment:o.coment,onOnSubmit:m.onCommentSubmit},null,8,["articleId","comment","onOnSubmit"])):f("",!0)]),_:1})}const oe=_(se,[["render",ne]]),ie={name:"ArticlePage",components:{LikeComp:R,CommentsList:oe,ImageComp:N,LoadingAndErrorSc:B,ArticleMenuList:U},data:()=>({isLoading:!1,error:!1,msg:null,showComments:!1,article:null}),async mounted(){const e=this.$store.getters.getArticle;if(e)this.article=e;else{this.isLoading=!0,this.error=!1,this.msg=null;const n=await T.loadArticle(this.$route.params.id);this.isLoading=!1,n.state?this.article=n.article:(this.error=!0,this.msg=n.message)}},computed:{likes(){return this.article.articleLikes?this.article.articleLikes:[]},comments(){return this.article.articleComments?this.article.articleComments:[]},commentsCount(){return this.comments.length}},methods:{onShowComments:function(){this.showComments=!this.showComments}}};function me(e,n,i,L,o,m){const u=a("LoadingAndErrorSc"),h=a("ArticleMenuList"),I=a("image-comp"),V=a("like-comp"),M=a("CommentsList");return c(),v($,null,[t(u,{isLoading:e.isLoading,msg:e.msg,error:e.error},null,8,["isLoading","msg","error"]),!e.isLoading&&!e.error&&e.article?(c(),d(p,{key:0,flat:"",class:"pa-2"},{default:s(()=>[t(p,{flat:"",class:"mb-4 text-primary"},{default:s(()=>[t(E,null,{activator:s(({props:O})=>[t(C,F({icon:"mdi-dots-vertical"},O,{flat:""}),null,16)]),default:s(()=>[t(h,{article:e.article},null,8,["article"])]),_:1}),l(" "+r(e.article.title),1)]),_:1}),e.article.writter?(c(),d(y,{key:0,class:"my-2"},{default:s(()=>[l(r(e.$t("writer"))+": ",1),H("strong",null,r(e.article.writter.name.toUpperCase()),1)]),_:1})):f("",!0),t(y,null,{default:s(()=>[l(r(new Date(e.article.updatedAt).toDateString()),1)]),_:1}),t(b,{class:"my-2"},{default:s(()=>[t(S,null,{default:s(()=>[t(I,{src:e.article.image,alt:e.article.title,mx_h:"300px",mx_w:"600px",mi_h:"250px",mi_w:"250px"},null,8,["src","alt"])]),_:1}),t(S,null,{default:s(()=>[t(g,null,{default:s(()=>[l(r(e.article.shortContent),1)]),_:1})]),_:1})]),_:1}),t(g,null,{default:s(()=>[l(r(e.article.content),1)]),_:1}),t(b,{class:"my-4 mx-2"},{default:s(()=>[t(V,{"article-likes":m.likes,"article-id":e.article.Id},null,8,["article-likes","article-id"]),t(J),t(C,{size:"small",class:"mx-2",flat:"",variant:"text",color:"secondary","append-icon":this.showComments?"mdi-comment-text":"mdi-comment-text-multiple",onClick:m.onShowComments},{default:s(()=>[l(r(e.$t("showComments")),1)]),_:1},8,["append-icon","onClick"])]),_:1}),t(K),e.showComments?(c(),d(M,{key:1,articleId:e.article.Id},null,8,["articleId"])):f("",!0)]),_:1})):f("",!0)],64)}const Ce=_(ie,[["render",me]]);export{Ce as default};
