import{I as R}from"./ImageComp-72199301.js";import{L as F,B as T}from"./BookMark-5bf8a908.js";import{_ as p,R as _,v as w,r as a,o as l,g as b,a as t,w as s,i as g,x,y as O,j as z,m as A,k as C,b as i,f as k,F as E,c,e as B,t as d,l as N,d as u,z as L,h as M,A as v,V as j,B as P}from"./index-da405de2.js";import{V as U}from"./VVirtualScroll-d798d507.js";import{V as S}from"./VContainer-2af66bad.js";import"./getScrollParent-6bb6c202.js";const $={components:{ResMsg:_},props:["articleId","comment"],emits:["onSubmit"],data(){return{loading:!1,error:!1,msg:null,commentContent:null}},updated(){this.comment&&(this.commentContent=this.comment.comment)},methods:{required:e=>!!e||"Required.",onSubmit:async function(){const e=this.$store.getters.isAuth;if(this.commentContent&&e){this.error=!1,this.msg=null,this.loading=!0;let n=null;this.comment?(this.comment.comment=this.commentContent,n=await w.updateArticleComment(this.comment),n.state&&(n.comment=this.comment)):(n=await w.sendArticleComment({articleId:this.articleId,comment:this.commentContent}),n.state&&(n.comment.user=this.$store.getters.getUser)),this.loading=!1,n.state&&(this.$emit("onSubmit",n.comment),this.commentContent=null),this.error=!n.state,this.msg=n.message,setTimeout(()=>{this.error=!1,this.msg=null},2e3)}else this.error=!0,this.msg="Can Not Send Empty Comment",setTimeout(()=>{this.msg=null,this.error=!1},2e3)}}};function q(e,n,m,I,o,r){const h=a("res-msg");return l(),b(E,null,[t(k,{flat:"",class:"d-flex flex","max-height":"100px"},{default:s(()=>[t(g,null,{default:s(()=>[t(x,{onSubmit:O(r.onSubmit,["prevent"])},{default:s(()=>[t(z,{modelValue:o.commentContent,"onUpdate:modelValue":n[0]||(n[0]=f=>o.commentContent=f),color:"primary",label:"Comment",variant:"underlined"},null,8,["modelValue"])]),_:1},8,["onSubmit"])]),_:1}),t(A,{end:""},{default:s(()=>[t(C,{loading:o.loading,color:"primary",class:"ma-4","append-icon":"mdi-send",type:"submit",end:"",onClick:r.onSubmit},{default:s(()=>[i(" Send ")]),_:1},8,["loading","onClick"])]),_:1})]),_:1}),t(h,{msg:o.msg,error:o.error},null,8,["msg","error"])],64)}const W=p($,[["render",q]]),G={props:["comment","userId"],emits:["onDeleted","onEdit"],components:{ResMsg:_},data:()=>({isLoading:!1,error:!1,msg:null}),methods:{deleteComment:async function(){if(this.userId===this.comment.userId){this.isLoading=!0,this.error=!1,this.msg=null;const e=await w.deleteArticleComment(this.comment.Id);this.isLoading=!1,e.state&&this.$emit("onDeleted",this.comment),this.error=!e.state,this.msg=e.message,setTimeout(()=>{this.msg=null,this.error=!1},2e3)}},onEditComment:function(){this.$emit("onEdit",this.comment)}}};function H(e,n,m,I,o,r){const h=a("res-msg");return l(),c(k,{class:"ma-2 pa-2"},{default:s(()=>[t(B,null,{default:s(()=>[t(g,null,{default:s(()=>[i(d(m.comment.user.name),1)]),_:1}),t(N),m.comment.userId===m.userId?(l(),c(A,{key:0},{default:s(()=>[t(C,{color:"primary",variant:"text","prepend-icon":"mdi-note-edit",onClick:r.onEditComment},{default:s(()=>[i(" Edit ")]),_:1},8,["onClick"]),t(C,{color:"red",onClick:r.deleteComment,loading:e.isLoading,variant:"text","prepend-icon":"mdi-note-remove"},{default:s(()=>[i(" Delete ")]),_:1},8,["onClick","loading"])]),_:1})):u("",!0)]),_:1}),t(h,{msg:e.msg,error:e.error},null,8,["msg","error"]),t(g,{class:"grey mx-4 ps-2"},{default:s(()=>[i(d(m.comment.comment),1)]),_:1}),t(L,null,{default:s(()=>[i(d(m.comment.updatedAt),1)]),_:1})]),_:1})}const J=p(G,[["render",H]]),K={name:"CommentsList",props:["articleId"],components:{CommentForm:W,CommentComp:J,ResMsg:_},data(){return{isLoading:!0,error:!1,page:0,msg:null,myId:null,coment:null,articleComments:[]}},async mounted(){this.$store.getters.isAuth&&(this.myId=this.$store.getters.getUser.Id),await this.loadArticleComments()},methods:{onCommentDeleted:function(e){const n=this.articleComments.filter(m=>m.Id!==e.Id);this.articleComments=n},onEditComment:function(e){this.coment=e},onCommentSubmit:function(e){if(this.coment){const n=this.articleComments.filter(m=>m.Id!==e.Id);this.articleComments=n,this.articleComments.push(e),this.coment=null}else this.articleComments.push(e)},loadArticleComments:async function(){this.isLoading=!0,this.msg=null,this.error=!1;const e=await M.loadArticleComments(this.page,this.articleId);this.isLoading=!1,e.state&&e.comments?this.articleComments.push(...e.comments):(this.error=!0,this.msg=e.message)}}};function Q(e,n,m,I,o,r){const h=a("CommentComp"),f=a("ResMsg"),y=a("CommentForm");return l(),c(S,{class:"mb-4"},{default:s(()=>[t(S,null,{default:s(()=>[o.articleComments.length?(l(),c(U,{key:0,items:o.articleComments,"max-height":"400px"},{default:s(({item:V})=>[t(h,{comment:V,userId:o.myId,onOnDeleted:r.onCommentDeleted,onOnEdit:r.onEditComment},null,8,["comment","userId","onOnDeleted","onOnEdit"])]),_:1},8,["items"])):u("",!0)]),_:1}),o.isLoading?(l(),c(k,{key:0},{default:s(()=>[t(v,{color:"primary",indeterminate:"",size:"34","justify-center":"","justify-content-center":""})]),_:1})):u("",!0),t(f,{msg:o.msg,error:o.error},null,8,["msg","error"]),o.myId?(l(),c(y,{key:1,articleId:m.articleId,comment:o.coment,onOnSubmit:r.onCommentSubmit},null,8,["articleId","comment","onOnSubmit"])):u("",!0)]),_:1})}const X=p(K,[["render",Q]]),Y={name:"ArticlePage",components:{LikeComp:F,CommentsList:X,ImageComp:R,ResMsg:_,BookMark:T},data:()=>({isLoading:!1,error:!1,msg:null,showComments:!1,article:null}),async mounted(){const e=this.$store.getters.getArticle;if(e)this.article=e;else{this.isLoading=!0,this.error=!1,this.msg=null;const n=await M.loadArticle(this.$route.params.id);this.isLoading=!1,n.state?this.article=n.article:(this.error=!0,this.msg=n.message)}},computed:{likes(){return this.article.articleLikes?this.article.articleLikes:[]},comments(){return this.article.articleComments?this.article.articleComments:[]},commentsCount(){return this.comments.length}},methods:{onShowComments:function(){this.showComments=!this.showComments}}};function Z(e,n,m,I,o,r){const h=a("ResMsg"),f=a("ImageComp"),y=a("BookMark"),V=a("like-comp"),D=a("CommentsList");return l(),b(E,null,[e.isLoading?(l(),c(v,{key:0,color:"primary",indeterminate:"",size:"34"})):u("",!0),t(h,{msg:e.msg,error:e.error},null,8,["msg","error"]),!e.isLoading&&!e.error&&e.article?(l(),c(k,{key:1,flat:"",class:"pa-2"},{default:s(()=>[t(j,null,{default:s(()=>[i(d(e.article.title),1)]),_:1}),e.article.writter?(l(),c(L,{key:0},{default:s(()=>[i(" Writter: "+d(e.article.writter.name),1)]),_:1})):u("",!0),t(L,null,{default:s(()=>[i(d(e.article.updatedAt),1)]),_:1}),t(g,null,{default:s(()=>[i(d(e.article.shortContent),1)]),_:1}),t(f,{src:e.article.image,alt:e.article.title,mx_h:"300px",mx_w:"300px"},null,8,["src","alt"]),t(g,null,{default:s(()=>[i(d(e.article.content),1)]),_:1}),t(B,{class:"my-2"},{default:s(()=>[t(C,{"append-icon":this.showComments?"mdi-comment-text":"mdi-comment-text-multiple",size:"small",onClick:r.onShowComments,class:"mx-4",flat:"",variant:"text",color:"secondary"},{default:s(()=>[i("Show Comments")]),_:1},8,["append-icon","onClick"]),t(y,{"user-book-marks":e.article.userBookMarks,"article-id":e.article.Id},null,8,["user-book-marks","article-id"]),t(V,{"article-likes":r.likes,"article-id":e.article.Id},null,8,["article-likes","article-id"])]),_:1}),t(P),e.showComments?(l(),c(D,{key:1,articleId:e.article.Id},null,8,["articleId"])):u("",!0)]),_:1})):u("",!0)],64)}const re=p(Y,[["render",Z]]);export{re as default};
