import{s as S,a as I}from"./authController-d6d7ac01.js";import{s as R}from"./signin-076c814e.js";import{s as _,g as F,a as $,b as k}from"./getCurrentUser-2dab7320.js";import{_ as B,R as M,L as N,C as U,c as p,w as t,e as h,r as n,o as f,a,V as v,b as l,t as i,z as c,v as D,x as T,f as E,g,B as w,j as O,k as L}from"./index-655d32d5.js";import{z as q}from"./vue-tel-input-e8a6f7da.js";import{V as b}from"./VRow-bb3aae33.js";import{V as z}from"./VCheckbox-f80cfc55.js";async function K(e){return await _(F(),{url:"http://localhost:3000"+e,handleCodeInApp:!0}).then(()=>({state:!0,result:null})).catch(s=>({state:!1,result:s}))}async function Y(e,s){return await $(k,e,{url:"http://localhost:3000"+s,handleCodeInApp:!0}).then(o=>({state:!0,result:o})).catch(o=>({state:!1,result:o}))}const G={name:"LogIn",components:{ResMsg:M,LogoComp:N,VueTelInput:q,LangToggleComp:U},data:()=>({passwordVisible:!1,loading:!1,forgetloading:!1,error:!1,msg:null,usePhone:!1,email:null,phone:null,password:null,rules:{required:e=>!!e||"Required.",password:e=>e.length>=6&&e.length<=20||"Max 20 characters , Min 6",phone:e=>(e==null?void 0:e.length)<=10?!0:"Name must be less than 10 characters.",email:e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"Invalid e-mail."}}),async mounted(){const e=this.$route.query;this.email=e.email,this.phone=e.phone,this.phone&&(this.usePhone=!0)},methods:{logIn:async function(){if((await this.$refs.logInForm.validate()).valid){this.loading=!0,this.error=!1,this.msg=null;const s=await S({phoneEmail:this.usePhone?this.phone:this.email,password:this.password});if(this.loading=!1,this.error=!s.state,this.error&&(this.msg=s.message),s.state&&s.isVerified&&(this.msg=s.message,this.$store.dispatch("logIn",s),this.$router.push({name:"Home"})),s.state&&!s.isVerified)if(this.usePhone)this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/login"}});else{this.loading=!0;const{state:o,result:u}=await R(this.email,this.password);if(o){const d=await K("/login");d.state?this.msg=s.message:(this.error=!0,this.msg=d.result.message)}else this.error=!0,this.msg=u.message;this.loading=!1}}else this.msg="Must Fill All Fields Correctly",this.error=!0},foregetPassword:async function(){if(this.usePhone)if(this.phone){this.forgetloading=!0,this.error=!1,this.msg=null;const e=await I(this.phone);this.forgetloading=!1,this.error=!e.state,this.msg=e.message,e.state&&this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/resetpassword"}})}else this.error=!0,this.msg="Must provide phone number";else if(await this.$refs.em.validate()){this.forgetloading=!0,this.error=!1,this.msg=null;const s=await I(this.email);if(this.error=!s.state,this.msg=s.message,s.state){const{state:o,result:u}=await Y(this.email,"/resetpassword");o?this.msg="We Sent You Email To Reset Password":(this.error=!0,this.msg=u.message)}this.forgetloading=!1}else this.error=!0,this.msg="Must provide email"}}};function Z(e,s,o,u,d,m){const A=n("router-link"),V=n("LangToggleComp"),P=n("logo-comp"),y=n("vue-tel-input"),C=n("res-msg");return f(),p(h,{class:"mx-auto py-4 px-8",elevation:"8","max-width":"448",rounded:"lg",align:"center"},{default:t(()=>[a(b,{justify:"center",align:"center"},{default:t(()=>[a(v,null,{default:t(()=>[l(i(e.$t("login")),1)]),_:1}),a(c),a(A,{to:{name:"Home"}},{default:t(()=>[l(i(e.$t("home")),1)]),_:1}),a(V)]),_:1}),a(P,{size:"150"}),a(L,null,{default:t(()=>[a(D,{ref:"logInForm",onSubmit:T(m.logIn,["prevent"])},{default:t(()=>[a(z,{class:"my-0",modelValue:e.usePhone,"onUpdate:modelValue":s[0]||(s[0]=r=>e.usePhone=r),color:"secondary",label:e.$t("usePhone")},null,8,["modelValue","label"]),e.usePhone?(f(),p(h,{key:0,flat:""},{default:t(()=>[a(y,{modelValue:e.phone,"onUpdate:modelValue":s[1]||(s[1]=r=>e.phone=r),mode:"international",defaultCountry:"Ye",autoFormat:""},null,8,["modelValue"])]),_:1})):(f(),p(h,{key:1,flat:""},{default:t(()=>[a(E,{modelValue:e.email,"onUpdate:modelValue":s[2]||(s[2]=r=>e.email=r),ref:"em",rules:[e.rules.required,e.rules.email],color:"primary",label:e.$t("inlYourEmail"),placeholder:e.$t("inpYourEmail"),variant:"underlined"},null,8,["modelValue","rules","label","placeholder"])]),_:1})),a(E,{modelValue:e.password,"onUpdate:modelValue":s[3]||(s[3]=r=>e.password=r),rules:[e.rules.required,e.rules.password],"append-inner-icon":e.passwordVisible?"mdi-eye-off":"mdi-eye",type:e.passwordVisible?"text":"password","onClick:appendInner":s[4]||(s[4]=r=>e.passwordVisible=!e.passwordVisible),class:"mt-4",color:"primary",label:e.$t("inlYourPassword"),placeholder:e.$t("inpYourPassword"),variant:"underlined"},null,8,["modelValue","rules","append-inner-icon","type","label","placeholder"])]),_:1},8,["onSubmit"]),a(b,null,{default:t(()=>[a(c),a(g,{flat:"",onClick:m.foregetPassword,loading:e.forgetloading,class:"text-caption text-decoration-none text-blue justify-end",rel:"noopener noreferrer"},{default:t(()=>[l(i(e.$t("forgetPass")),1)]),_:1},8,["onClick","loading"])]),_:1}),a(w,{class:"my-2"}),a(C,{msg:e.msg,error:e.error},null,8,["msg","error"]),a(w,{class:"my-2"}),a(g,{loading:e.loading,disabled:e.loading,block:"",color:"primary",size:"large",type:"submit",variant:"elevated",onClick:m.logIn},{default:t(()=>[l(i(e.$t("login")),1)]),_:1},8,["loading","disabled","onClick"]),a(O,null,{default:t(()=>[l(i(e.$t("notSignUp"))+" ",1),a(g,{end:"",flat:"",variant:"text",class:"text-decoration-none text-secondary",to:{name:"SignUp"}},{default:t(()=>[l(i(e.$t("signup")),1)]),_:1})]),_:1})]),_:1})]),_:1})}const ee=B(G,[["render",Z]]);export{ee as default};
