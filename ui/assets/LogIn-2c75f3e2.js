import{s as C,a as b}from"./authController-486fbfd3.js";import{s as S}from"./signin-2263bfec.js";import{s as k,g as R,a as F,b as N}from"./getCurrentUser-b51edf58.js";import{_ as B,R as D,L as M,C as U,r as n,o as m,c as p,w as t,f as h,a,V as v,b as o,t as T,l as f,e as g,x as O,y as q,i as c,j as E,k as I,B as w,m as L,z as $,q as z}from"./index-05bb36e0.js";import{V as K}from"./VCheckbox-c2f90397.js";import{V as A}from"./VContainer-689e4d46.js";async function G(e){return await k(R(),{url:"https://alakhbar.onrender.com"+e,handleCodeInApp:!0}).then(()=>({state:!0,result:null})).catch(s=>({state:!1,result:s}))}async function Z(e,s){return await F(N,e,{url:"https://alakhbar.onrender.com"+s,handleCodeInApp:!0}).then(r=>({state:!0,result:r})).catch(r=>({state:!1,result:r}))}const x={name:"LogIn",components:{ResMsg:D,LogoComp:M,VueTelInput:U},data:()=>({pageTitle:"Log In",passwordVisible:!1,loading:!1,forgetloading:!1,error:!1,msg:null,usePhone:!1,email:null,phone:null,password:null,rules:{required:e=>!!e||"Required.",password:e=>e.length>=6&&e.length<=20||"Max 20 characters , Min 6",phone:e=>(e==null?void 0:e.length)<=10?!0:"Name must be less than 10 characters.",email:e=>/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)||"Invalid e-mail."}}),async mounted(){const e=this.$route.query;this.email=e.email,this.phone=e.phone,this.phone&&(this.usePhone=!0)},methods:{logIn:async function(){if((await this.$refs.logInForm.validate()).valid){this.loading=!0,this.error=!1,this.msg=null;const s=await C({phoneEmail:this.usePhone?this.phone:this.email,password:this.password});if(this.loading=!1,this.error=!s.state,this.error&&(this.msg=s.message),s.state&&s.isVerified&&(this.msg=s.message,this.$store.dispatch("logIn",s),this.$router.push({name:"Home"})),s.state&&!s.isVerified)if(this.usePhone)this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/login"}});else{this.loading=!0;const{state:r,result:l}=await S(this.email,this.password);if(r){const d=await G("/login");d.state?this.msg=s.message:(this.error=!0,this.msg=d.result.message)}else this.error=!0,this.msg=l.message;this.loading=!1}}else this.msg="Must Fill All Fields Correctly",this.error=!0},foregetPassword:async function(){if(this.usePhone)if(this.phone){this.forgetloading=!0,this.error=!1,this.msg=null;const e=await b(this.phone);this.forgetloading=!1,this.error=!e.state,this.msg=e.message,e.state&&this.$router.push({name:"Verification",query:{mode:"phoneVerify",phone:this.phone,continueUrl:"/resetpassword"}})}else this.error=!0,this.msg="Must provide phone number";else if(await this.$refs.em.validate()){this.forgetloading=!0,this.error=!1,this.msg=null;const s=await b(this.email);if(this.error=!s.state,this.msg=s.message,s.state){const{state:r,result:l}=await Z(this.email,"/resetpassword");r?this.msg="We Sent You Email To Reset Password":(this.error=!0,this.msg=l.message)}this.forgetloading=!1}else this.error=!0,this.msg="Must provide email"}}};function H(e,s,r,l,d,u){const V=n("router-link"),_=n("logo-comp"),P=n("vue-tel-input"),y=n("res-msg");return m(),p(h,{class:"mx-auto py-4 px-8",elevation:"8","max-width":"448",rounded:"lg"},{default:t(()=>[a(g,null,{default:t(()=>[a(v,null,{default:t(()=>[o(T(e.pageTitle),1)]),_:1}),a(f),a(V,{to:{name:"Home"}},{default:t(()=>[o("Home")]),_:1})]),_:1}),a(_,{size:"150"}),a(A,null,{default:t(()=>[a(O,{ref:"logInForm",onSubmit:q(u.logIn,["prevent"])},{default:t(()=>[a(K,{class:"my-0",modelValue:e.usePhone,"onUpdate:modelValue":s[0]||(s[0]=i=>e.usePhone=i),color:"secondary",label:"Use Phone Number"},null,8,["modelValue"]),e.usePhone?(m(),p(h,{key:0,flat:""},{default:t(()=>[a(c,{class:"text-subtitle-1 text-medium-emphasis"},{default:t(()=>[o("Phone ")]),_:1}),a(P,{modelValue:e.phone,"onUpdate:modelValue":s[1]||(s[1]=i=>e.phone=i),mode:"international",defaultCountry:"Ye",autoFormat:""},null,8,["modelValue"])]),_:1})):(m(),p(h,{key:1,flat:""},{default:t(()=>[a(c,{class:"text-subtitle-1 text-medium-emphasis"},{default:t(()=>[o("Email ")]),_:1}),a(E,{modelValue:e.email,"onUpdate:modelValue":s[2]||(s[2]=i=>e.email=i),ref:"em",rules:[e.rules.required,e.rules.email],density:"compact",placeholder:"Email address","prepend-inner-icon":"mdi-email-outline",variant:"outlined"},null,8,["modelValue","rules"])]),_:1})),a(c,{class:"text-subtitle-1 text-medium-emphasis"},{default:t(()=>[o("Passwrod ")]),_:1}),a(E,{modelValue:e.password,"onUpdate:modelValue":s[3]||(s[3]=i=>e.password=i),rules:[e.rules.required,e.rules.password],"append-inner-icon":e.passwordVisible?"mdi-eye-off":"mdi-eye",type:e.passwordVisible?"text":"password",density:"compact",placeholder:"Enter your password","prepend-inner-icon":"mdi-lock-outline",variant:"outlined","onClick:appendInner":s[4]||(s[4]=i=>e.passwordVisible=!e.passwordVisible)},null,8,["modelValue","rules","append-inner-icon","type"])]),_:1},8,["onSubmit"]),a(g,null,{default:t(()=>[a(f),a(I,{flat:"",onClick:u.foregetPassword,loading:e.forgetloading,class:"text-caption text-decoration-none text-blue justify-end",rel:"noopener noreferrer"},{default:t(()=>[o("forgot login password?")]),_:1},8,["onClick","loading"])]),_:1}),a(w,{class:"my-2"}),a(y,{msg:e.msg,error:e.error},null,8,["msg","error"]),a(w,{class:"my-2"}),a(L,null,{default:t(()=>[a(I,{loading:e.loading,disabled:e.loading,block:"",color:"primary",size:"large",type:"submit",variant:"elevated",onClick:u.logIn},{default:t(()=>[o(" Log In ")]),_:1},8,["loading","disabled","onClick"])]),_:1}),a(A,{class:"px-0"},{default:t(()=>[a(g,{"align-content":"center"},{default:t(()=>[a($,null,{default:t(()=>[o("Do Not You have an account "),a(I,{end:"",flat:"",class:"text-decoration-none text-secondary",to:{name:"SignUp"}},{default:t(()=>[o(" signup"),a(z,{icon:"mdi-chevron-right"})]),_:1})]),_:1}),a(f)]),_:1})]),_:1})]),_:1})]),_:1})}const ee=B(x,[["render",H]]);export{ee as default};
